import{r as p}from"./index-qCb0-TeD.js";import{r as W}from"./traditional-B_ldJKp3.js";class P{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){const s={listener:t};return this.listeners.add(s),this.onSubscribe(),()=>{this.listeners.delete(s),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const L=typeof window>"u"||"Deno"in window;function pt(){}function vt(e,t){return typeof e=="function"?e(t):e}function X(e){return typeof e=="number"&&e>=0&&e!==1/0}function bt(e,t){return e.filter(s=>!t.includes(s))}function mt(e,t,s){const n=e.slice(0);return n[t]=s,n}function wt(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Ct(e,t,s){return E(e)?typeof t=="function"?{...s,queryKey:e,queryFn:t}:{...t,queryKey:e}:e}function Y(e,t,s){return E(e)?typeof t=="function"?{...s,mutationKey:e,mutationFn:t}:{...t,mutationKey:e}:typeof e=="function"?{...t,mutationFn:e}:{...e}}function xt(e,t,s){return E(e)?[{...t,queryKey:e},s]:[e||{},t]}function Rt(e,t){const{type:s="all",exact:n,fetchStatus:i,predicate:r,queryKey:o,stale:c}=e;if(E(o)){if(n){if(t.queryHash!==Z(o,t.options))return!1}else if(!k(t.queryKey,o))return!1}if(s!=="all"){const a=t.isActive();if(s==="active"&&!a||s==="inactive"&&a)return!1}return!(typeof c=="boolean"&&t.isStale()!==c||typeof i<"u"&&i!==t.state.fetchStatus||r&&!r(t))}function Et(e,t){const{exact:s,fetching:n,predicate:i,mutationKey:r}=e;if(E(r)){if(!t.options.mutationKey)return!1;if(s){if(g(t.options.mutationKey)!==g(r))return!1}else if(!k(t.options.mutationKey,r))return!1}return!(typeof n=="boolean"&&t.state.status==="loading"!==n||i&&!i(t))}function Z(e,t){return((t==null?void 0:t.queryKeyHashFn)||g)(e)}function g(e){return JSON.stringify(e,(t,s)=>F(s)?Object.keys(s).sort().reduce((n,i)=>(n[i]=s[i],n),{}):s)}function k(e,t){return D(e,t)}function D(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?!Object.keys(t).some(s=>!D(e[s],t[s])):!1}function U(e,t){if(e===t)return e;const s=j(e)&&j(t);if(s||F(e)&&F(t)){const n=s?e.length:Object.keys(e).length,i=s?t:Object.keys(t),r=i.length,o=s?[]:{};let c=0;for(let a=0;a<r;a++){const f=s?a:i[a];o[f]=U(e[f],t[f]),o[f]===e[f]&&c++}return n===r&&c===n?e:o}return t}function _(e,t){if(e&&!t||t&&!e)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}function j(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function F(e){if(!A(e))return!1;const t=e.constructor;if(typeof t>"u")return!0;const s=t.prototype;return!(!A(s)||!s.hasOwnProperty("isPrototypeOf"))}function A(e){return Object.prototype.toString.call(e)==="[object Object]"}function E(e){return Array.isArray(e)}function N(e){return new Promise(t=>{setTimeout(t,e)})}function K(e){N(0).then(e)}function Mt(){if(typeof AbortController=="function")return new AbortController}function Ot(e,t,s){return s.isDataEqual!=null&&s.isDataEqual(e,t)?e:typeof s.structuralSharing=="function"?s.structuralSharing(e,t):s.structuralSharing!==!1?U(e,t):t}class $ extends P{constructor(){super(),this.setup=t=>{if(!L&&window.addEventListener){const s=()=>t();return window.addEventListener("visibilitychange",s,!1),window.addEventListener("focus",s,!1),()=>{window.removeEventListener("visibilitychange",s),window.removeEventListener("focus",s)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.cleanup)==null||t.call(this),this.cleanup=void 0}}setEventListener(t){var s;this.setup=t,(s=this.cleanup)==null||s.call(this),this.cleanup=t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()})}setFocused(t){this.focused!==t&&(this.focused=t,this.onFocus())}onFocus(){this.listeners.forEach(({listener:t})=>{t()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const tt=new $,Q=["online","offline"];class et extends P{constructor(){super(),this.setup=t=>{if(!L&&window.addEventListener){const s=()=>t();return Q.forEach(n=>{window.addEventListener(n,s,!1)}),()=>{Q.forEach(n=>{window.removeEventListener(n,s)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.cleanup)==null||t.call(this),this.cleanup=void 0}}setEventListener(t){var s;this.setup=t,(s=this.cleanup)==null||s.call(this),this.cleanup=t(n=>{typeof n=="boolean"?this.setOnline(n):this.onOnline()})}setOnline(t){this.online!==t&&(this.online=t,this.onOnline())}onOnline(){this.listeners.forEach(({listener:t})=>{t()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const G=new et;function st(e){return Math.min(1e3*2**e,3e4)}function I(e){return(e??"online")==="online"?G.isOnline():!0}class z{constructor(t){this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}}function St(e){return e instanceof z}function nt(e){let t=!1,s=0,n=!1,i,r,o;const c=new Promise((l,d)=>{r=l,o=d}),a=l=>{n||(m(new z(l)),e.abort==null||e.abort())},f=()=>{t=!0},u=()=>{t=!1},y=()=>!tt.isFocused()||e.networkMode!=="always"&&!G.isOnline(),M=l=>{n||(n=!0,e.onSuccess==null||e.onSuccess(l),i==null||i(),r(l))},m=l=>{n||(n=!0,e.onError==null||e.onError(l),i==null||i(),o(l))},x=()=>new Promise(l=>{i=d=>{const v=n||!y();return v&&l(d),v},e.onPause==null||e.onPause()}).then(()=>{i=void 0,n||e.onContinue==null||e.onContinue()}),w=()=>{if(n)return;let l;try{l=e.fn()}catch(d){l=Promise.reject(d)}Promise.resolve(l).then(M).catch(d=>{var v,R;if(n)return;const b=(v=e.retry)!=null?v:3,C=(R=e.retryDelay)!=null?R:st,O=typeof C=="function"?C(s,d):C,h=b===!0||typeof b=="number"&&s<b||typeof b=="function"&&b(s,d);if(t||!h){m(d);return}s++,e.onFail==null||e.onFail(s,d),N(O).then(()=>{if(y())return x()}).then(()=>{t?m(d):w()})})};return I(e.networkMode)?w():x().then(w),{promise:c,cancel:a,continue:()=>(i==null?void 0:i())?c:Promise.resolve(),cancelRetry:f,continueRetry:u}}const it=console;function rt(){let e=[],t=0,s=u=>{u()},n=u=>{u()};const i=u=>{let y;t++;try{y=u()}finally{t--,t||c()}return y},r=u=>{t?e.push(u):K(()=>{s(u)})},o=u=>(...y)=>{r(()=>{u(...y)})},c=()=>{const u=e;e=[],u.length&&K(()=>{n(()=>{u.forEach(y=>{s(y)})})})};return{batch:i,batchCalls:o,schedule:r,setNotifyFunction:u=>{s=u},setBatchNotifyFunction:u=>{n=u}}}const T=rt();class ot{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),X(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(t){this.cacheTime=Math.max(this.cacheTime||0,t??(L?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class gt extends ot{constructor(t){super(),this.defaultOptions=t.defaultOptions,this.mutationId=t.mutationId,this.mutationCache=t.mutationCache,this.logger=t.logger||it,this.observers=[],this.state=t.state||B(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options={...this.defaultOptions,...t},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(t){this.dispatch({type:"setState",state:t})}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.observers=this.observers.filter(s=>s!==t),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var t,s;return(t=(s=this.retryer)==null?void 0:s.continue())!=null?t:this.execute()}async execute(){const t=()=>{var h;return this.retryer=nt({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(S,J)=>{this.dispatch({type:"failed",failureCount:S,error:J})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(h=this.options.retry)!=null?h:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},s=this.state.status==="loading";try{var n,i,r,o,c,a,f,u;if(!s){var y,M,m,x;this.dispatch({type:"loading",variables:this.options.variables}),await((y=(M=this.mutationCache.config).onMutate)==null?void 0:y.call(M,this.state.variables,this));const S=await((m=(x=this.options).onMutate)==null?void 0:m.call(x,this.state.variables));S!==this.state.context&&this.dispatch({type:"loading",context:S,variables:this.state.variables})}const h=await t();return await((n=(i=this.mutationCache.config).onSuccess)==null?void 0:n.call(i,h,this.state.variables,this.state.context,this)),await((r=(o=this.options).onSuccess)==null?void 0:r.call(o,h,this.state.variables,this.state.context)),await((c=(a=this.mutationCache.config).onSettled)==null?void 0:c.call(a,h,null,this.state.variables,this.state.context,this)),await((f=(u=this.options).onSettled)==null?void 0:f.call(u,h,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:h}),h}catch(h){try{var w,l,d,v,R,b,C,O;throw await((w=(l=this.mutationCache.config).onError)==null?void 0:w.call(l,h,this.state.variables,this.state.context,this)),await((d=(v=this.options).onError)==null?void 0:d.call(v,h,this.state.variables,this.state.context)),await((R=(b=this.mutationCache.config).onSettled)==null?void 0:R.call(b,void 0,h,this.state.variables,this.state.context,this)),await((C=(O=this.options).onSettled)==null?void 0:C.call(O,void 0,h,this.state.variables,this.state.context)),h}finally{this.dispatch({type:"error",error:h})}}}dispatch(t){const s=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"loading":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!I(this.options.networkMode),status:"loading",variables:t.variables};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"};case"setState":return{...n,...t.state}}};this.state=s(this.state),T.batch(()=>{this.observers.forEach(n=>{n.onMutationUpdate(t)}),this.mutationCache.notify({mutation:this,type:"updated",action:t})})}}function B(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class ut extends P{constructor(t,s){super(),this.client=t,this.setOptions(s),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const n=this.options;this.options=this.client.defaultMutationOptions(t),_(n,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(s=this.currentMutation)==null||s.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const s={listeners:!0};t.type==="success"?s.onSuccess=!0:t.type==="error"&&(s.onError=!0),this.notify(s)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,s){return this.mutateOptions=s,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:B(),s={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=s}notify(t){T.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var s,n,i,r;(s=(n=this.mutateOptions).onSuccess)==null||s.call(n,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(i=(r=this.mutateOptions).onSettled)==null||i.call(r,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var o,c,a,f;(o=(c=this.mutateOptions).onError)==null||o.call(c,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(a=(f=this.mutateOptions).onSettled)==null||a.call(f,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(({listener:u})=>{u(this.currentResult)})})}}var at=W();const lt=at.useSyncExternalStore,q=p.createContext(void 0),H=p.createContext(!1);function V(e,t){return e||(t&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=q),window.ReactQueryClientContext):q)}const ct=({context:e}={})=>{const t=p.useContext(V(e,p.useContext(H)));if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Ft=({client:e,children:t,context:s,contextSharing:n=!1})=>{p.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]);const i=V(s,n);return p.createElement(H.Provider,{value:!s&&n},p.createElement(i.Provider,{value:e},t))};function ht(e,t){return typeof e=="function"?e(...t):!!e}function Pt(e,t,s){const n=Y(e,t,s),i=ct({context:n.context}),[r]=p.useState(()=>new ut(i,n));p.useEffect(()=>{r.setOptions(n)},[r,n]);const o=lt(p.useCallback(a=>r.subscribe(T.batchCalls(a)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),c=p.useCallback((a,f)=>{r.mutate(a,f).catch(ft)},[r]);if(o.error&&ht(r.options.useErrorBoundary,[o.error]))throw o.error;return{...o,mutate:c,mutateAsync:o.mutate}}function ft(){}export{X as A,ht as B,gt as M,Ft as Q,ot as R,P as S,ct as a,lt as b,it as c,bt as d,Ot as e,pt as f,Mt as g,nt as h,St as i,I as j,Z as k,xt as l,Rt as m,T as n,Et as o,Ct as p,tt as q,mt as r,G as s,wt as t,Pt as u,vt as v,g as w,k as x,_ as y,L as z};
