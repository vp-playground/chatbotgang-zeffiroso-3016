var de=Object.defineProperty;var H=e=>{throw TypeError(e)};var he=(e,r,t)=>r in e?de(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var L=(e,r,t)=>he(e,typeof r!="symbol"?r+"":r,t),M=(e,r,t)=>r.has(e)||H("Cannot "+t);var n=(e,r,t)=>(M(e,r,"read from private field"),t?t.call(e):r.get(e)),u=(e,r,t)=>r.has(e)?H("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,t),o=(e,r,t,i)=>(M(e,r,"write to private field"),i?i.call(e,t):r.set(e,t),t),c=(e,r,t)=>(M(e,r,"access private method"),t);var D=(e,r,t,i)=>({set _(a){o(e,r,a,t)},get _(){return n(e,r,i)}});import{j as Q}from"./emotion-react-jsx-runtime.browser.esm-B6nDGTOp.js";import{i as T}from"./inspectMessage-DlwZE6zu.js";import{c as fe,s as me}from"./traditional-B_ldJKp3.js";import{E as te}from"./index-Ds41-CWB.js";import{e as we}from"./types-Dn-G_zsM.js";import{f as pe}from"./pick-BRmevVyy.js";import{g as ye}from"./index-BPqQDtUc.js";import{T as Y}from"./Trans-B7RBgX3a.js";import{m as j}from"./message-DDWR6R3O.js";class re extends Error{constructor(r){super(r),this.name="TimeoutError"}}class ve extends Error{constructor(r){super(),this.name="AbortError",this.message=r}}const G=e=>globalThis.DOMException===void 0?new ve(e):new DOMException(e),K=e=>{const r=e.reason===void 0?G("This operation was aborted."):e.reason;return r instanceof Error?r:G(r)};function be(e,r){const{milliseconds:t,fallback:i,message:a,customTimers:l={setTimeout,clearTimeout}}=r;let d;const y=new Promise((q,I)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(r.signal){const{signal:b}=r;b.aborted&&I(K(b)),b.addEventListener("abort",()=>{I(K(b))})}if(t===Number.POSITIVE_INFINITY){e.then(q,I);return}const B=new re;d=l.setTimeout.call(void 0,()=>{if(i){try{q(i())}catch(b){I(b)}return}typeof e.cancel=="function"&&e.cancel(),a===!1?q():a instanceof Error?I(a):(B.message=a??`Promise timed out after ${t} milliseconds`,I(B))},t),(async()=>{try{q(await e)}catch(b){I(b)}})()}).finally(()=>{y.clear()});return y.clear=()=>{l.clearTimeout.call(void 0,d),d=void 0},y}function Ee(e,r,t){let i=0,a=e.length;for(;a>0;){const l=Math.trunc(a/2);let d=i+l;t(e[d],r)<=0?(i=++d,a-=l+1):a=l}return i}var p;class Ie{constructor(){u(this,p,[])}enqueue(r,t){t={priority:0,...t};const i={priority:t.priority,run:r};if(this.size&&n(this,p)[this.size-1].priority>=t.priority){n(this,p).push(i);return}const a=Ee(n(this,p),i,(l,d)=>d.priority-l.priority);n(this,p).splice(a,0,i)}dequeue(){const r=n(this,p).shift();return r==null?void 0:r.run}filter(r){return n(this,p).filter(t=>t.priority===r.priority).map(t=>t.run)}get size(){return n(this,p).length}}p=new WeakMap;var g,F,E,S,N,C,m,P,h,_,w,x,v,W,s,ne,ae,se,oe,le,O,U,k,V,ue,R;class ie extends te{constructor(t){var i,a;super();u(this,s);u(this,g);u(this,F);u(this,E,0);u(this,S);u(this,N);u(this,C,0);u(this,m);u(this,P);u(this,h);u(this,_);u(this,w,0);u(this,x);u(this,v);u(this,W);L(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Ie,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((i=t.intervalCap)==null?void 0:i.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((a=t.interval)==null?void 0:a.toString())??""}\` (${typeof t.interval})`);o(this,g,t.carryoverConcurrencyCount),o(this,F,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),o(this,S,t.intervalCap),o(this,N,t.interval),o(this,h,new t.queueClass),o(this,_,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,o(this,W,t.throwOnTimeout===!0),o(this,v,t.autoStart===!1)}get concurrency(){return n(this,x)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);o(this,x,t),c(this,s,V).call(this)}async add(t,i={}){return i={timeout:this.timeout,throwOnTimeout:n(this,W),...i},new Promise((a,l)=>{n(this,h).enqueue(async()=>{var d;D(this,w)._++,D(this,E)._++;try{(d=i.signal)==null||d.throwIfAborted();let f=t({signal:i.signal});i.timeout&&(f=be(Promise.resolve(f),{milliseconds:i.timeout})),i.signal&&(f=Promise.race([f,c(this,s,ue).call(this,i.signal)]));const y=await f;a(y),this.emit("completed",y)}catch(f){if(f instanceof re&&!i.throwOnTimeout){a();return}l(f),this.emit("error",f)}finally{c(this,s,se).call(this)}},i),this.emit("add"),c(this,s,O).call(this)})}async addAll(t,i){return Promise.all(t.map(async a=>this.add(a,i)))}start(){return n(this,v)?(o(this,v,!1),c(this,s,V).call(this),this):this}pause(){o(this,v,!0)}clear(){o(this,h,new(n(this,_)))}async onEmpty(){n(this,h).size!==0&&await c(this,s,R).call(this,"empty")}async onSizeLessThan(t){n(this,h).size<t||await c(this,s,R).call(this,"next",()=>n(this,h).size<t)}async onIdle(){n(this,w)===0&&n(this,h).size===0||await c(this,s,R).call(this,"idle")}get size(){return n(this,h).size}sizeBy(t){return n(this,h).filter(t).length}get pending(){return n(this,w)}get isPaused(){return n(this,v)}}g=new WeakMap,F=new WeakMap,E=new WeakMap,S=new WeakMap,N=new WeakMap,C=new WeakMap,m=new WeakMap,P=new WeakMap,h=new WeakMap,_=new WeakMap,w=new WeakMap,x=new WeakMap,v=new WeakMap,W=new WeakMap,s=new WeakSet,ne=function(){return n(this,F)||n(this,E)<n(this,S)},ae=function(){return n(this,w)<n(this,x)},se=function(){D(this,w)._--,c(this,s,O).call(this),this.emit("next")},oe=function(){c(this,s,k).call(this),c(this,s,U).call(this),o(this,P,void 0)},le=function(){const t=Date.now();if(n(this,m)===void 0){const i=n(this,C)-t;if(i<0)o(this,E,n(this,g)?n(this,w):0);else return n(this,P)===void 0&&o(this,P,setTimeout(()=>{c(this,s,oe).call(this)},i)),!0}return!1},O=function(){if(n(this,h).size===0)return n(this,m)&&clearInterval(n(this,m)),o(this,m,void 0),this.emit("empty"),n(this,w)===0&&this.emit("idle"),!1;if(!n(this,v)){const t=!n(this,s,le);if(n(this,s,ne)&&n(this,s,ae)){const i=n(this,h).dequeue();return i?(this.emit("active"),i(),t&&c(this,s,U).call(this),!0):!1}}return!1},U=function(){n(this,F)||n(this,m)!==void 0||(o(this,m,setInterval(()=>{c(this,s,k).call(this)},n(this,N))),o(this,C,Date.now()+n(this,N)))},k=function(){n(this,E)===0&&n(this,w)===0&&n(this,m)&&(clearInterval(n(this,m)),o(this,m,void 0)),o(this,E,n(this,g)?n(this,w):0),c(this,s,V).call(this)},V=function(){for(;c(this,s,O).call(this););},ue=async function(t){return new Promise((i,a)=>{t.addEventListener("abort",()=>{a(t.reason)},{once:!0})})},R=async function(t,i){return new Promise(a=>{const l=()=>{i&&!i()||(this.off(t,l),a())};this.on(t,l)})};we(["AuthorizationStatus.authorized","AuthorizationStatus.denied","AuthorizationStatus.notDetermined","AuthorizationStatus.provisional"]);const X={"AuthorizationStatus.authorized":"granted","AuthorizationStatus.denied":"denied","AuthorizationStatus.notDetermined":"default","AuthorizationStatus.provisional":"default"},Te=e=>e in X?X[e]:"default",Ae=100,ce=fe(()=>({logs:[]}),me);function A(e){console.log("[flutterWebViewAppSdk]",e),ce.setState(r=>({logs:[`[${pe(new Date,"mm:ss.sss")}] ${e}`,...r.logs].slice(0,Ae)}))}const $=!!("flutter_inappwebview"in window&&window.flutter_inappwebview);class ge extends Error{constructor(){super(...arguments);L(this,"name","NonFlutterWebViewAppError")}}const Fe=new ie({concurrency:1}),z=(()=>{const e=async(...t)=>{if(A(T`callHandler, args: ${t}`),!$||!window.flutter_inappwebview){const a=T`not a Flutter WebView App, isFlutterWebViewApp: ${$}, window.flutter_inappwebview: ${window.flutter_inappwebview}`;throw A(a),new ge(a)}const i=await window.flutter_inappwebview.callHandler(...t);return A(T`callHandler, args: ${t}, result: ${i}`),i};return async(...t)=>(A(T`queuedCallHandler, args: ${t}`),await Fe.add(async()=>e(...t)))})(),Ne=async()=>z("requestNotificationPermission"),Pe=async()=>z("getCaacWebViewAppFcmToken"),xe=async()=>z("revokeCaacWebViewAppFcmToken"),ze=(()=>{if(!$)return;const e=new te,r=window.flutterPermissionUpdated;return window.flutterPermissionUpdated=(...t)=>{r==null||r(...t);const[i]=t;e.emit("flutterPermissionUpdated",Te(i))},e})(),$e=/Android/i.test(navigator.userAgent);async function Se(e){return z("downloadBase64Image",e)}async function Ce(e){return z("caacWebViewAppOpenBrowser",e)}async function _e(){return z("caacSSOGetJWT")}A(T`initialized, isFlutterWebViewApp: ${$}`);const J={isFlutterWebViewApp:$,isAndroid:$e,requestNotificationPermission:Ne,getFcmToken:Pe,revokeFcmToken:xe,downloadFile:Se,openBrowser:Ce,eventEmitter:ze,useFlutterDebugLogsStore:ce,requestDataFromExternalBrowser:_e,log:A},We=new ie({concurrency:3});function qe(e){return new Promise((r,t)=>{const i=new FileReader;i.onload=()=>{r(i.result)},i.onerror=t,i.readAsDataURL(e)})}async function De(e){const r=await We.add(()=>qe(e));if(!r)throw new Error(T`Failed to convert blob to data URL, result: ${r}, blob: ${e}`);return r}function Z(){return/[<>:"/\\|?*\u0000-\u001F]/g}function Oe(){return/^(con|prn|aux|nul|com\d|lpt\d)$/i}const Ve=100,Re=/^\.+(\\|\/)|^\.+$/,Le=/\.+$/;function Me(e,r={}){const t=/[\u0000-\u001F\u0080-\u009F]/g,i=/([<>:"/\\|?*\u0000-\u001F]){2,}/g;if(typeof e!="string")throw new TypeError("Expected a string");const a=r.replacement===void 0?"!":r.replacement;if(Z().test(a)&&t.test(a))throw new Error("Replacement string cannot contain reserved filename characters");a.length>0&&(e=e.replace(i,"$1")),e=e.normalize("NFD"),e=e.replace(Re,a),e=e.replace(Z(),a),e=e.replace(t,a),e=e.replace(Le,""),a.length>0&&(!(e[0]===".")&&e[0]==="."&&(e=a+e),e[e.length-1]==="."&&(e+=a)),e=Oe().test(e)?e+a:e;const l=typeof r.maxLength=="number"?r.maxLength:Ve;if(e.length>l){const d=e.lastIndexOf(".");if(d===-1)e=e.slice(0,l);else{const f=e.slice(0,d),y=e.slice(d);e=f.slice(0,Math.max(1,l-y.length))+y}}return e}const Ue=e=>{const r=document.createElement("a");r.href=e.href,r.download=Me(e.fileName),r.click()};function ke(e){const r=URL.createObjectURL(e.obj);Ue({href:r,fileName:e.fileName}),URL.revokeObjectURL(r)}const ee=async function(r){const t=ye("flutterWebviewAppDownload");if(t==="always"||t!=="never"&&J.isFlutterWebViewApp){const i=await De(r.obj);try{await J.downloadFile(i),j.success(Q(Y,{i18nKey:"flutterWebviewApp.downloadBase64Image.success.description"}))}catch{j.error(Q(Y,{i18nKey:"flutterWebviewApp.downloadBase64Image.fail.description"}))}return}return ke(r)};try{ee.displayName="downloadFile",ee.__docgenInfo={description:"",displayName:"downloadFile",props:{obj:{defaultValue:null,description:"",name:"obj",required:!0,type:{name:"Blob"}},fileName:{defaultValue:null,description:"",name:"fileName",required:!0,type:{name:"string"}}}}}catch{}export{ie as P,ee as d};
