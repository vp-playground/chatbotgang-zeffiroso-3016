import{j as n}from"./jsx-runtime-DzlC0hKS.js";import{useMDXComponents as a}from"./index-BhOTaKio.js";import{D as o}from"./Demo-CoQA1C2z.js";import{DemoAfterLabel as i}from"./createEasyForm.demo.afterLabel.stories-B06fUxwq.js";import{DemoEasyForm as m}from"./createEasyForm.demo.easyForm.stories--BZD5JVw.js";import{DemoInitialValues as l}from"./createEasyForm.demo.initialValues.stories-BZYz-7vS.js";import{DemoZustandPerformance as c}from"./createEasyForm.demo.zustandPerformance.stories-DvZE14wE.js";import"./index-qCb0-TeD.js";import"./emotion-react-jsx-runtime.browser.esm-B6nDGTOp.js";import"./useHandler-HI23tEoY.js";import"./useEventCallback-HuInTmxh.js";import"./emotion-react.browser.esm-DKbCFQzN.js";import"./index-C-yJI2Ou.js";import"./iframe-CR1OspGg.js";import"./index-fivQpuRm.js";import"./index-CmoHrzZA.js";import"./index-K0Oj1rov.js";import"./index-DrFu-skq.js";import"./Provider-BcjEMKgq.js";import"./omit-LJmhX_jk.js";import"./presets-fZzeZ6Sn.js";import"./DisabledContext-NEMnJEZA.js";import"./index-DbGQkxQ5.js";import"./assignDisplayName-lT0r0-ot.js";import"./index-BA0eH0Wu.js";import"./inspectMessage-DlwZE6zu.js";import"./index-BAiONZ7V.js";import"./define-D3i8B5cg.js";import"./types-Dn-G_zsM.js";import"./traditional-B_ldJKp3.js";import"./index-CrYrvawI.js";import"./index-C5U6HIMD.js";import"./index-DzgdUzM0.js";import"./index-iJUMMFGI.js";import"./index-MOlr3Ojg.js";import"./index-BsfIDxJ3.js";import"./index-CatqC4ig.js";import"./property-DTA7hnOA.js";import"./get-DGJ4vF0c.js";import"./vanilla-DtBHub2h.js";import"./capitalize-CY0R7VOI.js";import"./memo-BZYTsoqr.js";import"./getDisplayName-Cdt1H-sM.js";import"./index-BYk_lHUg.js";import"./CloseOutlined-CfOpPp0C.js";import"./AntdIcon-C0KfWvva.js";import"./shadow-smhd3i8u.js";import"./EllipsisOutlined-DrjggAzd.js";import"./toConsumableArray-BjwuTSou.js";import"./Overflow-DF_X_I1g.js";import"./Portal-qV56MC8h.js";import"./index-NCLGaooH.js";import"./useSize-XLj32eBt.js";import"./useId-CkKFPa5_.js";import"./isVisible-DhUEo0yb.js";import"./KeyCode-lh1qUinJ.js";import"./Dropdown-Bwcoigng.js";import"./useCSSVarCls-DCHdCyfl.js";import"./motion-DdkSFxyu.js";import"./index-BzlLN0ST.js";import"./pickAttrs-XdSaTJtx.js";import"./List-BcMJ_vkB.js";import"./index-BL1rL1qh.js";import"./collapse-BbEVqHco.js";import"./LoadingOutlined-PTw75qLp.js";import"./reactNode-CVIZC-dj.js";import"./pathe.ff20891b-CZu1kPQR.js";import"./PleaseCheckDoc-bB7fbsQQ.js";import"./index-qv6OY2dV.js";import"./InfoCircleFilled-0VRkendn.js";import"./CloseCircleFilled-Bgzza4Eo.js";import"./context-bgT8s9yI.js";import"./asyncToGenerator-CUe5B5qN.js";import"./index-DVKMw_5-.js";import"./DisabledContext-t2QVHVjL.js";import"./index-_xFncG76.js";import"./index-gEP6Tn1u.js";import"./createEasyForm.demo._utils.stories-BSaSpP18.js";import"./delay-CaiE5JvH.js";import"./whatsAppAttachment-Dl_LDQ-f.js";import"./models-D08OMJcb.js";import"./literalUnion-DyVqFjOM.js";import"./Iso4217CurrencySchema-I5Px3Rsp.js";import"./StringToNumberSchema-DICqxOFk.js";import"./WeekdayNumberSchema-CgxigkyA.js";import"./index-BQ-NB-n4.js";import"./index-CK730dNH.js";import"./index-DN361_u3.js";import"./index-CmqFZ15x.js";import"./index-8L6fjrd-.js";import"./pick-DYnZlk75.js";import"./pick-BRmevVyy.js";import"./isArguments-DZsL9lab.js";import"./tags-CpduBB1M.js";import"./sentry-DXsovuw2.js";import"./noop-DX6rZLP_.js";import"./isSymbol-DeEarUMJ.js";import"./isArrayLike-CCcVsAV0.js";import"./isNil-C7mktj5T.js";import"./index-Ctp16WHO.js";import"./useMutation-BNzakrCb.js";import"./index-FhjP52Um.js";import"./useQuery-xBc68arQ.js";import"./suspense-lUpQ7myJ.js";import"./infiniteQueryBehavior-B_QQvG9O.js";import"./tslib.es6-Ce0R1J-V.js";import"./isPrimitive-CtkJ6J5I.js";import"./env-B2Oq9Sof.js";import"./appConstant-DrkG7OWi.js";import"./debounce-DBoK0mBS.js";import"./omitBy-DH6X2eoo.js";import"./index-CwLK_-iS.js";import"./isPrimitive-Cbvsya_l.js";import"./flow-Caod8tMH.js";import"./flow-DLnCjMlr.js";import"./snakeCase-zsbFOLKH.js";import"./_isIndex-BOT1S-HL.js";import"./createEasyForm-UWj4xiVK.js";import"./random-CmfFXdz5.js";import"./index-CVRwA_xR.js";import"./index-C4jkG3Yz.js";import"./Trans-B7RBgX3a.js";import"./useTranslation-XVYQH2mr.js";import"./index-DIYPjkqE.js";import"./index-Bf2qc8Rt.js";import"./uniq-BL7hiWVS.js";import"./react-CzPQQEyf.js";import"./shouldProcessLinkClick-Cauo1FQC.js";import"./button-B7-d1yET.js";import"./index-BZsVY9hW.js";import"./Compact-VphdgA5n.js";import"./presetColors-DLnX3ho6.js";import"./compact-item-5orumCwJ.js";import"./index-H7DGQcO_.js";import"./BarLoading-Rkd_MQ9I.js";import"./useLocale-D6ZQsxC3.js";import"./emotion-styled-base.browser.esm-DcS0-Etw.js";import"./useZIndex-BbbELKB6.js";import"./ContextIsolator-CdD3uTNK.js";import"./useClosable-D7Zcp99m.js";import"./index-vGCD89VU.js";import"./PurePanel-Bml8ml_A.js";import"./navigate-CRWb9NLN.js";import"./styleChecker-BQsV-VhF.js";import"./index-CiDJ99qe.js";import"./colors-wf8q_7Rm.js";import"./TextArea-vizGfyJg.js";import"./useVariants-CK8wnbnE.js";import"./index-D0v7HZQV.js";import"./CheckOutlined-DcewmLkY.js";import"./compileTo-QMEyv3zH.js";import"./index-BPqQDtUc.js";import"./dummy-T6UpgMGd.js";import"./config-e2J7_s0o.js";import"./orgQueriesContext-CTNIHlpq.js";import"./createContext-Co4ks8zE.js";import"./index-DPz6_WSv.js";import"./index-Ds41-CWB.js";import"./index-DvseeTEo.js";import"./useBreakpoint-CVOk84jo.js";import"./index-ADXJD4hY.js";import"./safeString-CSiFDyUi.js";import"./CopyButton-CSca9IhR.js";import"./NarrowIconButton-CPJBcQ2f.js";import"./index-C5sRnb5L.js";import"./useIsTouchOnlyLikeDeviceStore-ChrBTq0u.js";import"./message-DDWR6R3O.js";import"./index-CXnOxbGU.js";import"./SearchOutlined-CS-6PfVh.js";import"./merge-BUZDYRsv.js";import"./cloneDeepWith-ktajmmvU.js";import"./isTypedArray-CzKvdEgb.js";import"./index-DHqc_-FW.js";import"./index-DrK2RkJp.js";import"./index-CogmkLD2.js";import"./useBubbleLock-OqGqq4Qb.js";import"./queryClient-BfEk7TBo.js";const r=`import { delay } from "@chatbotgang/etude/timer/delay";
import type { Meta } from "@storybook/react";
import {
  QueryClient,
  QueryClientProvider,
  useMutation,
  useQuery,
} from "@tanstack/react-query";
import { generatePleaseCheckDoc } from "@zeffiroso/storybook/utils/PleaseCheckDoc";
import { memo } from "@zeffiroso/utils/react/memo";
import { useSafeInvalidateQuery } from "@zeffiroso/zodios/useSafeInvalidateQuery";
import { secondsToMilliseconds } from "date-fns";
import { get, isEqual } from "es-toolkit/compat";
import type { ReactNode } from "react";
import { useMemo } from "react";
import { JSONTree } from "react-json-tree";
import type { IsUnknown } from "type-fest";

import type { BaseNamePath, Get } from "@/components/Form/createEasyForm";
import { createEasyForm } from "@/components/Form/createEasyForm";

const queryClient = new QueryClient();

const Wrapper = memo(function Wrapper({ children }: { children: ReactNode }) {
  return (
    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>
  );
});

type FormValues = {
  name: string;
  email: string;
  foo: {
    bar: Array<{
      baz: string;
      qux: number;
    }>;
  };
};

const initialValues: FormValues = {
  name: "test",
  email: "nobody@mail.cresclab.com",
  foo: {
    bar: [
      {
        baz: "test",
        qux: 1,
      },
    ],
  },
};

const mock = {
  values: initialValues,
  reset() {
    mock.values = initialValues;
  },
};

async function getValues() {
  await delay(secondsToMilliseconds(1));
  return mock.values;
}

const queryKey = ["test"];

function useGetValues() {
  return useQuery(queryKey, getValues);
}

function useSetValues({ onSuccess }: { onSuccess?: () => void } = {}) {
  const safeInvalidateQuery = useSafeInvalidateQuery();
  const mutation = useMutation(setValues, {
    onSettled() {
      safeInvalidateQuery(queryKey);
    },
    onSuccess,
  });
  return mutation;
}

async function setValues(values: FormValues) {
  await delay(secondsToMilliseconds(1));
  mock.values = values;
}

const EasyForm = createEasyForm<FormValues>();

const EasyFormHookState = memo(function EasyFormHookState() {
  const [easyForm] = EasyForm.useFormInstance();
  const touched = easyForm.hooks.useTouched();
  const validating = easyForm.hooks.useValidating();
  const validated = easyForm.hooks.useValidated();
  const invalid = easyForm.hooks.useInvalid();
  const dirty = easyForm.hooks.useDirty();
  return (
    <JSONTree
      data={{
        touched,
        validating,
        validated,
        invalid,
        dirty,
      }}
    />
  );
});

const EasyFormFields = memo(function EasyFormFields() {
  const [easyForm] = EasyForm.useFormInstance();
  const fields = easyForm.useStore((state) => state.fields);
  return (
    <JSONTree
      data={{
        fields,
      }}
    />
  );
});

const EasyFormValues = memo(function EasyFormValues() {
  const [easyForm] = EasyForm.useFormInstance();
  const values = easyForm.useStore((state) => state.values);
  return (
    <JSONTree
      data={{
        values,
      }}
    />
  );
});

const StatusHelp = function StatusHelp<Path extends BaseNamePath>(props: {
  name: IsUnknown<Get<FormValues, Path>> extends true ? never : Path;
}) {
  const [easyForm] = EasyForm.useFormInstance();
  const { touched, validating, validated, invalid, dirty } = easyForm.useStore(
    (state) => {
      const initialValues = state.initialValues;
      const field = state.fields.find((field) =>
        isEqual(
          Array.isArray(field.name) ? field.name : [field.name],
          Array.isArray(props.name) ? props.name : [props.name],
        ),
      );
      const touched = field?.touched ?? false;
      const validating = field?.validating ?? false;
      const validated = field?.validated ?? false;
      const invalid = (field?.errors?.length ?? 0) > 0;
      const dirty = !isEqual(
        field ? field.value : get(state.values, props.name),
        get(initialValues, props.name),
      );
      return {
        touched,
        validating,
        validated,
        invalid,
        dirty,
      };
    },
  );
  const help = useMemo<string>(
    () =>
      [
        ...(touched ? ["touched"] : []),
        ...(validating ? ["validating"] : []),
        ...(validated ? ["validated"] : []),
        ...(invalid ? ["invalid"] : []),
        ...(dirty ? ["dirty"] : []),
      ].join(", "),
    [dirty, invalid, touched, validated, validating],
  );
  return <>{help}</>;
};

const utils = Object.assign(generatePleaseCheckDoc(), {
  EasyForm,
  useGetValues,
  useSetValues,
  Wrapper,
  initialValues,
  EasyFormHookState,
  EasyFormFields,
  EasyFormValues,
  StatusHelp,
});

const meta = {
  component: EasyForm,
} satisfies Meta;

export default meta;
export { utils };
`,u=`import { css } from "@emotion/react";
import type { Meta } from "@storybook/react";
import { wrapPleaseCheckDoc } from "@zeffiroso/storybook/utils/PleaseCheckDoc";
import { memo } from "@zeffiroso/utils/react/memo";
import { Button, Input } from "antd";
import { Fragment, useMemo, useState } from "react";

import { ExternalLink } from "@/components/ExternalLink";
import { utils } from "@/components/Form/createEasyForm.demo._utils.stories";
import { RadioGroup } from "@/components/Radio";

const { EasyForm, initialValues, Wrapper } = utils;

const optionToRequiredMarkRecord = {
  undefined,
  false: false,
  true: true,
  optional: "optional",
} satisfies Record<
  string,
  React.ComponentProps<typeof EasyForm>["requiredMark"]
>;

const optionToLayout = {
  undefined,
  horizontal: "horizontal",
  inline: "inline",
  vertical: "vertical",
} satisfies Record<string, React.ComponentProps<typeof EasyForm>["layout"]>;

const optionToColon = {
  undefined,
  false: false,
  true: true,
};

const Form = memo(function Form() {
  const [, antForm] = EasyForm.useForm();
  const [requiredMarkOption, setRequiredMarkOption] =
    useState<keyof typeof optionToRequiredMarkRecord>("undefined");
  const requiredMark: React.ComponentProps<typeof EasyForm>["requiredMark"] =
    useMemo(
      () => optionToRequiredMarkRecord[requiredMarkOption],
      [requiredMarkOption],
    );

  const [layoutOption, setLayoutOption] =
    useState<keyof typeof optionToLayout>("undefined");
  const layout: React.ComponentProps<typeof EasyForm>["layout"] = useMemo(
    () => optionToLayout[layoutOption],
    [layoutOption],
  );

  const [colonOption, setColonOption] =
    useState<keyof typeof optionToColon>("undefined");
  const colon: React.ComponentProps<typeof EasyForm>["colon"] = useMemo(
    () => optionToColon[colonOption],
    [colonOption],
  );

  return (
    <EasyForm
      initialValues={initialValues}
      form={antForm}
      css={css\`
        display: flex;
        flex-direction: column;
        gap: inherit;
      \`}
      {...(requiredMark === undefined ? {} : { requiredMark })}
      {...(layout === undefined ? {} : { layout })}
      {...(colon === undefined ? {} : { colon })}
    >
      <EasyForm.Item label="Required Mark">
        <RadioGroup
          value={requiredMarkOption}
          options={Object.keys(optionToRequiredMarkRecord)}
          onChange={(e) => {
            setRequiredMarkOption(e.target.value as typeof requiredMarkOption);
          }}
        />
      </EasyForm.Item>
      <EasyForm.Item label="Layout">
        <RadioGroup
          value={layoutOption}
          options={Object.keys(optionToLayout)}
          onChange={(e) => {
            setLayoutOption(e.target.value as typeof layoutOption);
          }}
        />
      </EasyForm.Item>
      <EasyForm.Item label="Colon">
        <RadioGroup
          value={colonOption}
          options={Object.keys(optionToColon)}
          onChange={(e) => {
            setColonOption(e.target.value as typeof colonOption);
          }}
        />
      </EasyForm.Item>
      <EasyForm.Item
        name="name"
        label="Name"
        help={<utils.StatusHelp name="name" />}
      >
        <Input />
      </EasyForm.Item>
      <EasyForm.Item name="name" extra="Render without label">
        <Input />
      </EasyForm.Item>
      <EasyForm.Item
        name="email"
        label="Email"
        afterLabel={
          <ExternalLink href="https://cresclab.com" trailingIcon>
            Check cresclab.com
          </ExternalLink>
        }
        help={<utils.StatusHelp name="email" />}
      >
        <Input type="email" />
      </EasyForm.Item>
      <div
        css={css\`
          display: flex;
          justify-content: flex-end;
          gap: inherit;
        \`}
      >
        <Button htmlType="reset">Reset</Button>
        <Button htmlType="submit" type="primary">
          Submit
        </Button>
      </div>
    </EasyForm>
  );
});
const DemoAfterLabel = wrapPleaseCheckDoc(
  memo(function DemoInitialValues() {
    return (
      <Wrapper>
        <Form />
      </Wrapper>
    );
  }),
);

const meta = {
  component: Fragment,
} satisfies Meta;

export default meta;
export { DemoAfterLabel };
`,d=`import { delay } from "@chatbotgang/etude/timer/delay";
import { css } from "@emotion/react";
import type { Meta } from "@storybook/react";
import { wrapPleaseCheckDoc } from "@zeffiroso/storybook/utils/PleaseCheckDoc";
import { memo } from "@zeffiroso/utils/react/memo";
import { Button, Input } from "antd";
import { secondsToMilliseconds } from "date-fns";
import { Fragment } from "react";
import { JSONTree } from "react-json-tree";

import { utils } from "@/components/Form/createEasyForm.demo._utils.stories";

const { EasyForm, useSetValues, useGetValues, initialValues, Wrapper } = utils;

let autoIncrement = 1;

const Bar = memo(function Bar() {
  return (
    <EasyForm.List name={["foo", "bar"]}>
      {(FormItem, fields, { add, remove }) => (
        <div
          css={css\`
            display: flex;
            flex-direction: column;
            gap: inherit;
          \`}
        >
          {fields.map((field, index) => (
            <div
              key={index}
              css={css\`
                display: flex;
                flex-direction: column;
                justify-content: stretch;
                gap: inherit;
              \`}
            >
              <Button
                onClick={() => {
                  add(
                    {
                      qux: ++autoIncrement,
                      baz: \`baz-\${autoIncrement}\`,
                    },
                    field.name,
                  );
                }}
              >
                +
              </Button>
              <div
                css={css\`
                  display: flex;
                  gap: inherit;
                \`}
              >
                <div
                  css={css\`
                    display: flex;
                    flex-direction: column;
                    gap: inherit;
                  \`}
                >
                  <FormItem label="baz" name={[\`\${field.name}\`, "baz"]}>
                    <Input />
                  </FormItem>
                  <FormItem label="qux" name={[\`\${field.name}\`, "qux"]}>
                    <Input />
                  </FormItem>
                </div>
                <div
                  css={css\`
                    display: flex;
                    flex-direction: column;
                    gap: inherit;
                  \`}
                >
                  <Button
                    onClick={() => {
                      remove(field.name);
                    }}
                  >
                    -
                  </Button>
                </div>
              </div>
            </div>
          ))}
          <Button
            onClick={() =>
              add({
                qux: ++autoIncrement,
                baz: \`baz-\${autoIncrement}\`,
              })
            }
          >
            +
          </Button>
        </div>
      )}
    </EasyForm.List>
  );
});

const existNames = ["foo", "bar", "baz"];

const Form = memo(function Form() {
  const [easyForm, antForm] = EasyForm.useForm();
  const initial = easyForm.useStore((state) => state.initialValues);
  const query = useGetValues();
  const mutation = useSetValues({
    onSuccess: easyForm.controller.resetFields,
  });
  return (
    <EasyForm
      form={antForm}
      initialValues={query.isSuccess ? query.data : initialValues}
      onFinish={mutation.mutate}
      disabled={mutation.isLoading || query.isLoading}
      css={css\`
        display: flex;
        flex-flow: row wrap;
        gap: 1em;

        & > * {
          max-width: 300px;
        }
      \`}
    >
      <div
        css={css\`
          display: flex;
          flex-direction: column;
          gap: inherit;
        \`}
      >
        <EasyForm.Item
          name="name"
          label="Name"
          required
          rules={[
            {
              required: true,
            },
            {
              validator: async (_rule, value) => {
                await delay(secondsToMilliseconds(1));
                if (existNames.includes(value))
                  throw new Error("Name already exists");
              },
            },
          ]}
        >
          <Input />
        </EasyForm.Item>
        <EasyForm.Item
          name="email"
          label="Email"
          required
          rules={[
            {
              required: true,
            },
          ]}
        >
          <Input type="email" />
        </EasyForm.Item>
        <Bar />
        <div
          css={css\`
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-end;
            gap: inherit;
          \`}
        >
          <Button
            onClick={() => {
              easyForm.controller.setFieldsValue(query.data ?? initialValues);
            }}
          >
            Set Initial Values
          </Button>
          <Button
            onClick={() => {
              easyForm.controller.resetFields();
            }}
          >
            JS Reset
          </Button>
          <Button htmlType="reset">HTML Reset</Button>
          <Button htmlType="submit" type="primary">
            Submit
          </Button>
        </div>
      </div>
      <div>
        <h3>Initial Values</h3>
        <JSONTree data={initial} />
        <h3>Values</h3>
        <utils.EasyFormValues />
        <h3>Fields</h3>
        <utils.EasyFormFields />
        <code>easyForm.hooks</code>
        <utils.EasyFormHookState />
      </div>
    </EasyForm>
  );
});
const DemoEasyForm = wrapPleaseCheckDoc(
  memo(function DemoEasyForm() {
    return (
      <Wrapper>
        <Form />
      </Wrapper>
    );
  }),
);

const meta = {
  component: Fragment,
} satisfies Meta;

export default meta;
export { DemoEasyForm };
`,p=`import { css } from "@emotion/react";
import type { Meta } from "@storybook/react";
import { wrapPleaseCheckDoc } from "@zeffiroso/storybook/utils/PleaseCheckDoc";
import { memo } from "@zeffiroso/utils/react/memo";
import { Button, Input } from "antd";
import { Fragment } from "react";

import { utils } from "@/components/Form/createEasyForm.demo._utils.stories";

const { EasyForm, useSetValues, useGetValues, initialValues, Wrapper } = utils;

let autoIncrement = 1;

const Bar = memo(function Bar() {
  return (
    <EasyForm.List name={["foo", "bar"]}>
      {(FormItem, fields, { add, remove }) => (
        <div
          css={css\`
            display: flex;
            flex-direction: column;
            gap: inherit;
          \`}
        >
          {fields.map((field, index) => (
            <div
              key={index}
              css={css\`
                display: flex;
                flex-direction: column;
                justify-content: stretch;
                gap: inherit;
              \`}
            >
              <Button
                onClick={() => {
                  add(
                    {
                      qux: ++autoIncrement,
                      baz: \`baz-\${autoIncrement}\`,
                    },
                    field.name,
                  );
                }}
              >
                +
              </Button>
              <div
                css={css\`
                  display: flex;
                  gap: inherit;
                \`}
              >
                <div
                  css={css\`
                    display: flex;
                    flex-direction: column;
                    gap: inherit;
                  \`}
                >
                  <FormItem
                    label="baz"
                    name={[\`\${field.name}\`, "baz"]}
                    help={
                      <utils.StatusHelp
                        name={["foo", "bar", \`\${field.name}\`, "baz"]}
                      />
                    }
                  >
                    <Input />
                  </FormItem>
                  <FormItem
                    label="qux"
                    name={[\`\${field.name}\`, "qux"]}
                    help={
                      <utils.StatusHelp
                        name={["foo", "bar", \`\${field.name}\`, "qux"]}
                      />
                    }
                  >
                    <Input />
                  </FormItem>
                </div>
                <div
                  css={css\`
                    display: flex;
                    flex-direction: column;
                    gap: inherit;
                  \`}
                >
                  <Button
                    onClick={() => {
                      remove(field.name);
                    }}
                  >
                    -
                  </Button>
                </div>
              </div>
            </div>
          ))}
          <Button
            onClick={() =>
              add({
                qux: ++autoIncrement,
                baz: \`baz-\${autoIncrement}\`,
              })
            }
          >
            +
          </Button>
        </div>
      )}
    </EasyForm.List>
  );
});

const Form = memo(function Form() {
  const [easyForm, antForm] = EasyForm.useForm();
  const query = useGetValues();
  const mutation = useSetValues({
    onSuccess: () => {
      easyForm.controller.resetFields();
    },
  });
  return (
    <EasyForm
      form={antForm}
      initialValues={query.isSuccess ? query.data : initialValues}
      onFinish={mutation.mutate}
      disabled={mutation.isLoading || query.isLoading}
      css={css\`
        display: flex;
        flex-direction: column;
        gap: inherit;
      \`}
    >
      <utils.EasyFormHookState />
      <EasyForm.Item
        name="name"
        label="Name"
        help={<utils.StatusHelp name="name" />}
      >
        <Input />
      </EasyForm.Item>
      <EasyForm.Item
        name="email"
        label="Email"
        help={<utils.StatusHelp name="email" />}
      >
        <Input type="email" />
      </EasyForm.Item>
      <Bar />
      <div
        css={css\`
          display: flex;
          justify-content: flex-end;
          gap: inherit;
        \`}
      >
        <Button htmlType="reset">Reset</Button>
        <Button htmlType="submit" type="primary">
          Submit
        </Button>
      </div>
    </EasyForm>
  );
});
const DemoInitialValues = wrapPleaseCheckDoc(
  memo(function DemoInitialValues() {
    return (
      <Wrapper>
        <div
          css={css\`
            display: flex;
            flex-flow: row wrap;
            gap: 1em;

            & > * {
              max-width: 300px;
            }
          \`}
        >
          <Form />
          <Form />
        </div>
      </Wrapper>
    );
  }),
);

const meta = {
  component: Fragment,
} satisfies Meta;

export default meta;
export { DemoInitialValues };
`,f=`import { useHandler } from "@chatbotgang/etude/react/useHandler";
import { css } from "@emotion/react";
import type { Meta } from "@storybook/react";
import { wrapPleaseCheckDoc } from "@zeffiroso/storybook/utils/PleaseCheckDoc";
import { memo } from "@zeffiroso/utils/react/memo";
import { shallow } from "@zeffiroso/utils/zustand/shallow";
import { Button, Input } from "antd";
import { format } from "date-fns";
import objectInspect from "object-inspect";
import {
  createContext,
  Fragment,
  useContext,
  useEffect,
  useMemo,
  useState,
} from "react";
import { JSONTree } from "react-json-tree";
import { createWithEqualityFn } from "zustand/traditional";

import { utils } from "@/components/Form/createEasyForm.demo._utils.stories";

const { EasyForm, useSetValues, useGetValues, initialValues, Wrapper } = utils;

let autoIncrement = 1;

const Bar = memo(function Bar() {
  return (
    <EasyForm.List name={["foo", "bar"]}>
      {(FormItem, fields, { add, remove }) => (
        <div
          css={css\`
            display: flex;
            flex-direction: column;
            gap: inherit;
          \`}
        >
          {fields.map((field) => (
            <div
              key={field.key}
              css={css\`
                display: flex;
                flex-direction: column;
                justify-content: stretch;
                gap: inherit;
              \`}
            >
              <Button
                onClick={() => {
                  add(
                    {
                      qux: ++autoIncrement,
                      baz: \`baz-\${autoIncrement}\`,
                    },
                    field.name,
                  );
                }}
              >
                +
              </Button>
              <div
                css={css\`
                  display: flex;
                  gap: inherit;
                \`}
              >
                <div
                  css={css\`
                    display: flex;
                    flex-direction: column;
                    gap: inherit;
                  \`}
                >
                  <FormItem label="baz" name={[\`\${field.name}\`, "baz"]}>
                    <Input />
                  </FormItem>
                  <FormItem label="qux" name={[\`\${field.name}\`, "qux"]}>
                    <Input />
                  </FormItem>
                </div>
                <div
                  css={css\`
                    display: flex;
                    flex-direction: column;
                    gap: inherit;
                  \`}
                >
                  <Button
                    onClick={() => {
                      remove(field.name);
                    }}
                  >
                    -
                  </Button>
                </div>
              </div>
            </div>
          ))}
          <Button
            onClick={() =>
              add({
                qux: ++autoIncrement,
                baz: \`baz-\${autoIncrement}\`,
              })
            }
          >
            +
          </Button>
        </div>
      )}
    </EasyForm.List>
  );
});

const UseWatch = memo(function UseWatch() {
  const name = EasyForm.useWatch("name");
  return (
    <EasyForm.Item label="Name by useWatch">
      <Input value={objectInspect(name)} readOnly />
    </EasyForm.Item>
  );
});

const Form = memo(function Form() {
  const { addAutoIncrement } = useDemo();
  const [easyForm, antForm] = EasyForm.useForm();
  const query = useGetValues();
  const mutation = useSetValues({
    onSuccess: easyForm.controller.resetFields,
  });
  const { log } = useDemo();
  log("Form rendered!");
  return (
    <EasyForm
      form={antForm}
      initialValues={query.isSuccess ? query.data : initialValues}
      onFinish={mutation.mutate}
      disabled={mutation.isLoading || query.isLoading}
      css={css\`
        display: flex;
        flex-direction: column;
        gap: inherit;
      \`}
    >
      <utils.EasyFormHookState />
      <EasyForm.Item
        name="name"
        label="Name"
        rules={[
          {
            required: true,
          },
        ]}
      >
        <Input />
      </EasyForm.Item>
      <EasyForm.Item name="email" label="Email">
        <Input type="email" />
      </EasyForm.Item>
      <Bar />
      <UseWatch />
      <div
        css={css\`
          display: flex;
          flex-wrap: wrap;
          justify-content: flex-end;
          gap: inherit;
        \`}
      >
        <Button onClick={addAutoIncrement}>Add Auto Increment</Button>
        <Button htmlType="reset">Reset</Button>
        <Button htmlType="submit" type="primary">
          Submit
        </Button>
      </div>
    </EasyForm>
  );
});

function Log() {
  const { useLogStore, autoIncrement } = useDemo();
  const logs = useLogStore((state) => state.log);
  return (
    <div>
      <h2>Auto Increment State: {autoIncrement}</h2>
      <h2>Log</h2>
      <JSONTree
        data={logs.map(
          ({ content, datetime }) =>
            \`[\${format(datetime, "HH:mm:ss.SSS")}] \${content}\`,
        )}
      />
    </div>
  );
}

const LogSize = 10;

function createLogStore() {
  return createWithEqualityFn<{
    log: {
      content: string;
      datetime: Date;
    }[];
  }>()(() => ({ log: [] }), shallow);
}

const DemoContext = createContext<null | {
  log: (content: string) => void;
  useLogStore: ReturnType<typeof createLogStore>;
  autoIncrement: number;
  addAutoIncrement: () => void;
}>(null);

function useDemo() {
  const log = useContext(DemoContext);
  if (!log) throw new Error("DemoContext is null");

  return log;
}

const DemoZustandPerformance = wrapPleaseCheckDoc(
  memo(function DemoZustandPerformance() {
    const [useLogStore] = useState(() =>
      createWithEqualityFn<{
        log: {
          content: string;
          datetime: Date;
        }[];
      }>()(() => ({ log: [] }), shallow),
    );
    const log = useHandler((content: string) => {
      useLogStore.setState((state) => {
        const newLog = {
          content,
          datetime: new Date(),
        };
        return {
          log: [newLog, ...state.log.slice(0, LogSize - 1)],
        };
      });
    });
    useEffect(() => {
      log("DemoZustandPerformance rendered!");
    });
    const [autoIncrement, setAutoIncrement] = useState(0);
    const addAutoIncrement = useHandler(() => {
      setAutoIncrement((prev) => prev + 1);
    });
    const logContextValue = useMemo(
      () => ({ log, useLogStore, autoIncrement, addAutoIncrement }),
      [addAutoIncrement, autoIncrement, log, useLogStore],
    );
    return (
      <Wrapper>
        <DemoContext.Provider value={logContextValue}>
          <div
            css={css\`
              display: flex;
              flex-flow: row wrap;
              gap: 1em;

              & > * {
                max-width: 300px;
              }
            \`}
          >
            <Form />
            <Log />
          </div>
        </DemoContext.Provider>
      </Wrapper>
    );
  }),
);

const meta = {
  component: Fragment,
} satisfies Meta;

export default meta;
export { DemoZustandPerformance };
`;function s(t){const e={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...a(),...t.components};return n.jsxs(n.Fragment,{children:[n.jsx(e.h1,{id:"createeasyform",children:"createEasyForm"}),`
`,n.jsxs(e.p,{children:[n.jsx(e.code,{children:"EasyForm"})," allows us to create forms easily."]}),`
`,n.jsx(e.p,{children:"To create a form, we simply:"}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`const Form = createEasyForm<{
  name: string;
  age: number;
}>();
`})}),`
`,n.jsxs(e.p,{children:["Then we use the ",n.jsx(e.code,{children:"Form"})," component in a manner similar to the original Ant Design ",n.jsx(e.code,{children:"Form"})," component:"]}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`function MyComponent() {
  const [, antForm] = Form.useForm();

  return (
    <Form form={antForm}>
      <Form.Item name="name">
        <Input />
      </Form.Item>
      <Form.Item name="age">
        <InputNumber />
      </Form.Item>
    </Form>
  );
}
`})}),`
`,n.jsxs(e.p,{children:["Unlike Ant Design Form, which uses ",n.jsx(e.code,{children:"any"})," for everything and can lead to issues, EasyForm is more strictly typed and integrated with ",n.jsx(e.code,{children:"useWatch"}),", ",n.jsx(e.code,{children:"Form.Item"}),", and ",n.jsx(e.code,{children:"Form.List"}),"."]}),`
`,n.jsxs(e.p,{children:["A valid name prop is always required for ",n.jsx(e.code,{children:"EasyForm"})," components. For example, if we use ",n.jsx(e.code,{children:"createEasyForm<{ name: string }>"})," and then use ",n.jsx(e.code,{children:'<Form.Item name="nickname" />'}),", it will result in a type error."]}),`
`,n.jsxs(e.p,{children:["Due to the type checking relying on ",n.jsx(e.a,{href:"https://github.com/sindresorhus/type-fest",rel:"nofollow",children:"type-fest"}),"'s ",n.jsx(e.code,{children:"Get"}),", we need to use ",n.jsx(e.code,{children:"${number}"})," instead of just ",n.jsx(e.code,{children:"number"})," when working with arrays:"]}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`<Form.Item name={["users", 3, "name"]} /> // ❌
`})}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:'<Form.Item name={["users", `${3}`, "name"]} /> // ✅\n'})}),`
`,n.jsxs(e.p,{children:["When we utilize ",n.jsx(e.code,{children:"useWatch"}),", it will return the appropriate type depending on the ",n.jsx(e.code,{children:"name"})," prop:"]}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`useWatch("name"); // string | undefined
`})}),`
`,n.jsxs(e.p,{children:["The presence of ",n.jsx(e.code,{children:"undefined"})," is due to the fact that it will always return ",n.jsx(e.code,{children:"undefined"})," during the initial render."]}),`
`,n.jsx(e.h2,{id:"easyform",children:"EasyForm"}),`
`,n.jsxs(e.p,{children:["We can control or retrieve the state of the form using the ",n.jsx(e.code,{children:"easyForm"})," instance."]}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`const [easyForm, antForm] = Form.useForm();

// inside the Form component:
const [easyForm, antForm] = Form.useFormInstance();
`})}),`
`,n.jsxs(e.p,{children:["To reset fields or set field values, use ",n.jsx(e.code,{children:"easyForm.controller"})," instead. It uses the same interface as ",n.jsx(e.code,{children:"antForm"}),", but updates the state in the Zustand store."]}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-diff",children:`- antForm.setFieldsValue({ name: 'John' });
+ easyForm.controller.setFieldsValue({ name: 'John' });
`})}),`
`,n.jsxs(e.p,{children:["If we use ",n.jsx(e.code,{children:"antForm"})," APIs, the callbacks won't be invoked, the Zustand store won't be updated, and the values will appear incorrect from the perspective of the actual ",n.jsx(e.code,{children:"antForm"}),"."]}),`
`,n.jsx(o,{demo:n.jsx(m,{}),files:[{path:"easyForm.tsx",className:"language-tsx",content:d},{path:"_utils.tsx",className:"language-tsx",content:r}]}),`
`,n.jsxs(e.p,{children:["You can get the form states using ",n.jsx(e.code,{children:"easyForm.useStore"}),":"]}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`import { isEqual } from "lodash";

function MyComponent() {
  const [easyForm] = Form.useFormInstance();
  const values = easyForm.useStore((state) => state.values, isEqual);
  const fields = easyForm.useStore((state) => state.fields, isEqual);
}
`})}),`
`,n.jsxs(e.p,{children:["The usage of ",n.jsx(e.code,{children:"isEqual"})," here is optional, as we already verify its equality when updating the Zustand store."]}),`
`,n.jsx(e.p,{children:"We also provide useful hooks depend on the Zustand store:"}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`const touched = easyForm.hooks.useTouched(); // If the form has been modified.
const validating = easyForm.hooks.useValidating(); // If some fields are validating.
const validated = easyForm.hooks.useValidated(); // If some fields are validated.
const invalid = easyForm.hooks.useInvalid(); // If some fields are invalid.
const dirty = easyForm.hooks.useDirty(); // If the form values are "not equal" to the initial values.
`})}),`
`,n.jsxs(e.p,{children:["Notice that the field states are not synchronized and updated because the Ant Design Form Field components compute during their re-rendering. The fields are not updated immediately after the execution of ",n.jsx(e.code,{children:"resetFields"}),". If we want to detect whether a field has been reset, observe the ",n.jsx(e.code,{children:"touched"})," state using ",n.jsx(e.code,{children:"easyForm.hooks.useTouched"})," instead."]}),`
`,n.jsxs(e.p,{children:["When we use ",n.jsx(e.code,{children:"touched"})," to decide whether to render the ",n.jsx(e.code,{children:"<RouterPrompt />"})," component or not, right after calling ",n.jsx(e.code,{children:"resetFields"}),", the state is not immediately updated. The RouterPrompt remains active and will block navigation. To address this, we can utilize ",n.jsx(e.code,{children:"useSwitch"})," to delay the navigation."]}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`const mutation = useMutation(request, {
  onSuccess: () => {
    easyForm.controller.resetFields();
    // This will be blocked because the state is not updated immediately.
    navigate(listPage);
  },
});

/**
 * Instead, we can use the \`touched\` state to detect whether the fields have
 * been reset.
 */
const touched = easyForm.hooks.useTouched();
const [toListPage, toggleToListPage] = useSwitch(false);
useEffect(() => {
  if (!toListPage || touched) return;
  navigate(listPage);
}, [toListPage, touched]);
const mutation = useMutation(request, {
  onSuccess: () => {
    easyForm.controller.resetFields();
    toListPage.on();
  },
});
`})}),`
`,n.jsx(e.h2,{id:"formlist",children:"Form.List"}),`
`,n.jsxs(e.p,{children:["Because the ",n.jsx(e.code,{children:"name"})," for ",n.jsx(e.code,{children:"Form.Item"})," is inherited from ",n.jsx(e.code,{children:"Form.List"}),", we cannot use ",n.jsx(e.code,{children:"Form.Item"})," directly inside ",n.jsx(e.code,{children:"Form.List"}),". Instead, we can get another ",n.jsx(e.code,{children:"FieldItem"})," component with the ",n.jsx(e.code,{children:"name"})," type under ",n.jsx(e.code,{children:"Form.List"}),":"]}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-diff",children:`  <Form.List name="users">
-   {(fields, { add, remove }) => (
+   {(FormItem, fields, { add, remove }) => (
      <>
        {fields.map((field) => (
-         <EasyForm.Item key={field.key} name={[field.name, 'foo']}> // ❌ The name will throw a type error because it's for name from root.
+         <FormItem key={field.key} name={[field.name, 'foo']}> // ✅ The name is for name from Form.List.
`})}),`
`,n.jsxs(e.h2,{id:"reactive-form-initialvalues",children:["Reactive Form ",n.jsx(e.code,{children:"initialValues"})]}),`
`,n.jsxs(e.p,{children:["It integrates very well with ",n.jsx(e.code,{children:"query"})," in the ",n.jsx(e.a,{href:"https://tkdodo.eu/blog/react-query-and-forms#keeping-background-updates-on",rel:"nofollow",children:"TkDodo's Keeping background updates on"})," pattern. Unlike the example that uses the fallback value when there is no modified value, ",n.jsx(e.code,{children:"EasyForm"})," compares the value with the previous ",n.jsx(e.code,{children:"initialValues"})," to determine if it has been modified. It then applies only the values that have not been modified from the new ",n.jsx(e.code,{children:"initialValues"})," to the form."]}),`
`,n.jsx(o,{demo:n.jsx(l,{}),files:[{path:"essential.tsx",className:"language-tsx",content:p},{path:"_utils.tsx",className:"language-tsx",content:r}]}),`
`,n.jsxs(e.h2,{id:"easyformitem-afterlabel-prop",children:["EasyForm.Item ",n.jsx(e.code,{children:"afterLabel"})," Prop"]}),`
`,n.jsxs(e.p,{children:["We can use the ",n.jsx(e.code,{children:"afterLabel"})," prop to add a component after the label:"]}),`
`,n.jsx(o,{demo:n.jsx(i,{}),files:[{path:"essential.tsx",className:"language-tsx",content:u},{path:"_utils.tsx",className:"language-tsx",content:r}]}),`
`,n.jsx(e.h2,{id:"why-zustand",children:"Why Zustand?"}),`
`,n.jsx(e.p,{children:"In short, for performance."}),`
`,n.jsxs(e.ul,{children:[`
`,n.jsx(e.li,{children:"It computes only when it renders."}),`
`,n.jsx(e.li,{children:"It re-renders only when the return value from the selector changes."}),`
`]}),`
`,n.jsx(o,{demo:n.jsx(c,{}),files:[{path:"zustandPerformance.tsx",className:"language-tsx",content:f},{path:"_utils.tsx",className:"language-tsx",content:r}]}),`
`,n.jsx(e.p,{children:'In the above demo, when the form state changes, only components that utilize the Zustand Store will re-render. We can try interacting with the form fields, changing values and states, and observe that the log does not increase. Conversely, clicking the "Add Auto Increment" button triggers a re-render due to its use of state.'}),`
`,n.jsx(e.h2,{id:"tips",children:"Tips"}),`
`,n.jsx(e.p,{children:"In most cases, you need to reset the form and invalidate the query when the mutation is successful:"}),`
`,n.jsx(e.pre,{children:n.jsx(e.code,{className:"language-tsx",children:`const [easyForm, antForm] = EasyForm.useForm();
const query = useQuery(/* ... */);
const mutation = useMutation({
  /* ... */
  onSuccess: () => {
    query.invalidate();
    easyForm.controller.resetFields();
  },
});

return (
  <EasyForm form={antForm} initialValues={query.data ?? initialValues}>
    {/* ... */}
  </EasyForm>
);
`})})]})}function Dt(t={}){const{wrapper:e}={...a(),...t.components};return e?n.jsx(e,{...t,children:n.jsx(s,{...t})}):s(t)}export{Dt as default};
