import{j as _}from"./emotion-react-jsx-runtime.browser.esm-B6nDGTOp.js";import{u as v}from"./useHandler-HI23tEoY.js";import{r as et}from"./random-CmfFXdz5.js";import{c as j}from"./emotion-react.browser.esm-DKbCFQzN.js";import{t as k}from"./index-BA0eH0Wu.js";import{r as h}from"./index-qCb0-TeD.js";import{c as F,s as nt}from"./traditional-B_ldJKp3.js";import{M as ot}from"./index-_xFncG76.js";import{B as rt}from"./env-B2Oq9Sof.js";import{i as st}from"./inspectMessage-DlwZE6zu.js";import{a as it}from"./assignDisplayName-lT0r0-ot.js";import{g as at}from"./getDisplayName-Cdt1H-sM.js";import{o as ct}from"./index-Bf2qc8Rt.js";import{i as q,l as lt}from"./sentry-DXsovuw2.js";import{s as ut}from"./index-FhjP52Um.js";import{f as ft}from"./flow-Caod8tMH.js";import{u as dt}from"./uniq-BL7hiWVS.js";import{c as ht}from"./react-CzPQQEyf.js";import{s as mt,u as gt}from"./shouldProcessLinkClick-Cauo1FQC.js";import{p as pt}from"./pathe.ff20891b-CZu1kPQR.js";import{B as yt}from"./button-B7-d1yET.js";import{u as wt}from"./useMutation-BNzakrCb.js";import{n as bt}from"./noop-DX6rZLP_.js";import{a as kt}from"./index-DN361_u3.js";class N{constructor(e){this.children=[],this.parent=e}delete(e){const t=this.children.indexOf(e);return t===-1?!1:(this.children=this.children.slice(0,t).concat(this.children.slice(t+1)),this.children.length===0&&this.parent.delete(this),!0)}add(e){return this.children.push(e),this}}class H{constructor(e){this.parent=null,this.children={},this.parent=e||null}get(e){return this.children[e]}insert(e){let t=this;for(let o=0;o<e.length;o+=1){const r=e[o];let s=t.get(r);if(o===e.length-1)return s instanceof H&&(t.delete(s),s=null),s||(s=new N(t),t.children[r]=s),s;s instanceof N&&(s=null),s||(s=new H(t),t.children[r]=s),t=s}return t}delete(e){for(const t in this.children)if(this.children[t]===e){const r=delete this.children[t];return Object.keys(this.children).length===0&&this.parent&&this.parent.delete(this),r}return!1}}const Et={"¡":"1","™":"2","£":"3","¢":"4","∞":"5","§":"6","¶":"7","•":"8",ª:"9",º:"0","–":"-","≠":"=","⁄":"!","€":"@","‹":"#","›":"$",ﬁ:"%",ﬂ:"^","‡":"&","°":"*","·":"(","‚":")","—":"_","±":"+",œ:"q","∑":"w","®":"r","†":"t","¥":"y",ø:"o",π:"p","“":"[","‘":"]","«":"\\",Œ:"Q","„":"W","´":"E","‰":"R","ˇ":"T",Á:"Y","¨":"U","ˆ":"I",Ø:"O","∏":"P","”":"{","’":"}","»":"|",å:"a",ß:"s","∂":"d",ƒ:"f","©":"g","˙":"h","∆":"j","˚":"k","¬":"l","…":";",æ:"'",Å:"A",Í:"S",Î:"D",Ï:"F","˝":"G",Ó:"H",Ô:"J","":"K",Ò:"L",Ú:":",Æ:'"',Ω:"z","≈":"x",ç:"c","√":"v","∫":"b",µ:"m","≤":",","≥":".","÷":"/","¸":"Z","˛":"X",Ç:"C","◊":"V",ı:"B","˜":"N",Â:"M","¯":"<","˘":">","¿":"?"},Dt={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+","[":"{","]":"}","\\":"|",";":":","'":'"',",":"<",".":">","/":"?",q:"Q",w:"W",e:"E",r:"R",t:"T",y:"Y",u:"U",i:"I",o:"O",p:"P",a:"A",s:"S",d:"D",f:"F",g:"G",h:"H",j:"J",k:"K",l:"L",z:"Z",x:"X",c:"C",v:"V",b:"B",n:"N",m:"M"},vt={" ":"Space","+":"Plus"};function R(n,e=navigator.platform){var t,o,r;const{ctrlKey:s,altKey:a,metaKey:d,shiftKey:p,key:f}=n,c=[],i=[s,a,d,p];for(const[l,u]of i.entries())u&&c.push(W[l]);if(!W.includes(f)){const l=c.includes("Alt")&&K.test(e)&&(t=Et[f])!==null&&t!==void 0?t:f,u=c.includes("Shift")&&K.test(e)&&(o=Dt[l])!==null&&o!==void 0?o:l,y=(r=vt[u])!==null&&r!==void 0?r:u;c.push(y)}return c.join("+")}const W=["Control","Alt","Meta","Shift"];function U(n,e){let t;return t=St(n),t=Tt(t),t}const K=/Mac|iPod|iPhone|iPad/i;function St(n,e){var t;const o=typeof window>"u"?void 0:window,r=(t=o==null?void 0:o.navigator.platform)!==null&&t!==void 0?t:"",s=K.test(r)?"Meta":"Control";return n.replace("Mod",s)}function Tt(n){const e=n.split("+").pop(),t=[];for(const o of["Control","Alt","Meta","Shift"])n.includes(o)&&t.push(o);return e&&t.push(e),t.join("+")}const Q=" ";class L{constructor({onReset:e}={}){this._path=[],this.timer=null,this.onReset=e}get path(){return this._path}get sequence(){return this._path.join(Q)}registerKeypress(e){this._path=[...this._path,R(e)],this.startTimer()}reset(){var e;this.killTimer(),this._path=[],(e=this.onReset)===null||e===void 0||e.call(this)}killTimer(){this.timer!=null&&window.clearTimeout(this.timer),this.timer=null}startTimer(){this.killTimer(),this.timer=window.setTimeout(()=>this.reset(),L.CHORD_TIMEOUT)}}L.CHORD_TIMEOUT=1500;function I(n){if(!(n instanceof HTMLElement))return!1;const e=n.nodeName.toLowerCase(),t=(n.getAttribute("type")||"").toLowerCase();return e==="select"||e==="textarea"||e==="input"&&t!=="submit"&&t!=="reset"&&t!=="checkbox"&&t!=="radio"&&t!=="file"||n.isContentEditable}function Ct(n,e){const t=new CustomEvent("hotkey-fire",{cancelable:!0,detail:{path:e}});n.dispatchEvent(t)&&(I(n)?n.focus():n.click())}function Mt(n){const e=[];let t=[""],o=!1;for(let r=0;r<n.length;r++){if(o&&n[r]===","){e.push(t),t=[""],o=!1;continue}if(n[r]===Q){t.push(""),o=!1;continue}else n[r]==="+"?o=!1:o=!0;t[t.length-1]+=n[r]}return e.push(t),e.map(r=>r.map(s=>U(s)).filter(s=>s!=="")).filter(r=>r.length>0)}const T=new H,V=new WeakMap;let B=T;const M=new L({onReset(){B=T}});function Z(n){if(n.defaultPrevented||!(n.target instanceof Node))return;if(I(n.target)){const t=n.target;if(!t.id||!t.ownerDocument.querySelector(`[data-hotkey-scope="${t.id}"]`))return}const e=B.get(R(n));if(!e){M.reset();return}if(M.registerKeypress(n),B=e,e instanceof N){const t=n.target;let o=!1,r;const s=I(t);for(let a=e.children.length-1;a>=0;a-=1){r=e.children[a];const d=r.getAttribute("data-hotkey-scope");if(!s&&!d||s&&t.id===d){o=!0;break}}r&&o&&(Ct(r,M.path),n.preventDefault()),M.reset()}}function Ht(n,e){Object.keys(T.children).length===0&&document.addEventListener("keydown",Z);const o=Mt(n.getAttribute("data-hotkey")||"").map(r=>T.insert(r).add(n));V.set(n,o)}function Lt(n){const e=V.get(n);if(e&&e.length)for(const t of e)t&&t.delete(n);Object.keys(T.children).length===0&&document.removeEventListener("keydown",Z)}function Pt(n){return n.hasAttribute("disabled")}const _t=" ";function G(n){const e=[];let t=[""],o=!1;for(let r=0;r<n.length;r++){if(o&&n[r]===","){e.push(t),t=[""],o=!1;continue}if(n[r]===_t){t.push(""),o=!1;continue}else n[r]==="+"?o=!1:o=!0;t[t.length-1]+=n[r]}return e.push(t),e.map(r=>r.map(s=>U(s)).filter(s=>s!=="")).filter(r=>r.length>0)}function Nt(n){const e=new Set,t=new Map;let o,r,s=!0;const a=()=>{s||(s=!0,e.forEach(c=>c(o,o)))};return{getState:()=>{if(!s)return o;if(!r||Array.from(r).some(([c,i])=>!Object.is(c.getState(),i))){const c=new Map;o=n(l=>{if(!l)return o;const u=l.getState();return c.set(l,u),u}),r=c}if(e.size){const c=new Set(r.keys());t.forEach((i,l)=>{c.has(l)?c.delete(l):(i(),t.delete(l))}),c.forEach(i=>{t.set(i,i.subscribe(a))}),s=!1}return o},subscribe:c=>(e.add(c),()=>{e.delete(c),e.size||(t.forEach(i=>i()),t.clear(),s=!0)}),getInitialState:()=>{throw new Error("getInitialState is not available in derived store")},setState:()=>{throw new Error("setState is not available in derived store")},destroy:()=>{throw new Error("destory is not available in derived store")}}}const z=ht()(()=>!0),Kt=()=>z.setState(n=>!n),C=F()(()=>({items:[]}),nt);C.subscribe(function(e){if(e.items.length===0)return;const t=e.items.map(s=>({...s,edges:G(s.hotkey)})),o=[];if(t.forEach(function(a){const d=a.hotkeyScope;a.edges.forEach(function(c){if(o.some(l=>l.hotkeyScope===d&&q(l.sequence,c)))return;const i=t.filter(l=>d===l.hotkeyScope&&l.edges.some(u=>q(u,c)));i.length>1&&o.push({hotkeyScope:d,sequence:c,duplicatedItems:i})})}),o.length===0)return;console.error("Duplicate hotkeys detected.",o);const r=new Error(st`Duplicate hotkeys detected. ${o}`);r.name="DuplicateHotkeysError",lt(r)});function x(n){const e=typeof n=="string"?n:at(n),t=({hotkey:r,hotkeyScope:s,onHotkeyFire:a,onEnabledHotkeyFire:d,...p},f)=>{const c=z(),[i,l]=h.useState(null),u=v((...m)=>a==null?void 0:a(...m)),y=v((m,...D)=>{!(m.target instanceof HTMLElement)||!(m.currentTarget instanceof HTMLElement)||Pt(m.target)||d==null||d(m,...D)});h.useEffect(function(){if(i&&r&&c&&i instanceof HTMLElement)return Ht(i),i.addEventListener("hotkey-fire",u),i.addEventListener("hotkey-fire",y),C.setState(D=>({items:[...D.items,{element:i,hotkey:r,hotkeyScope:s}]})),function(){C.setState(P=>({items:P.items.filter(w=>w.element!==i)})),i.removeEventListener("hotkey-fire",u),i.removeEventListener("hotkey-fire",y),Lt(i)}},[i,r,c,s,y,u]);const E=h.useMemo(()=>Object.assign({},r?{"data-hotkey":r}:{},s?{"data-hotkey-scope":s}:{}),[r,s]);return _(n,{...E,...p,ref:ct([f,l])})},o=h.forwardRef(t);return it(o,`withHotKey(${e})`),o}const It=Nt(n=>ft(()=>n(C).items.flatMap(e=>{const t=e.hotkey;return G(t).flatMap(o=>o.flatMap(r=>r))}),dt)()),J=U("Mod+Shift+Z");C.setState(n=>({items:[...n.items,{element:document.documentElement,hotkey:J}]}));const Bt=ut(1);let S=null;function O(){S&&(clearTimeout(S),S=null)}function xt(){O(),S=setTimeout(O,Bt)}window.addEventListener("keydown",function(e){const t=R(e);if(t===J){if(S){O(),Kt();return}xt()}const o=It.getState();z.getState()&&o.includes(t)&&e.preventDefault()});try{x.displayName="withHotKey",x.__docgenInfo={description:"This HOC adds a `hotkey` prop to the component that will be used to install a\nhotkey on the element based on\n[@github/hotkey](https://github.com/github/hotkey).",displayName:"withHotKey",props:{}}}catch{}const X=et(),Y=`--click-count-down-progress-color-${X}`,A=`--click-count-down-progress-${X}`,Ot=j(`@layer emotion-component{&.ant-btn-primary:not(
        [disabled],
        .ant-btn-dangerous,
        .ant-btn-disabled,
        .ant-btn-background-ghost
      ){&.ant-btn-dashed{border-color:`,k.colors.neutral006,";}}&.ant-btn-disabled{border-color:",k.colors.neutral004,";background:",k.colors.neutral002,";&:hover{border-color:",k.colors.neutral004,";background:",k.colors.neutral002,";}}&>span{font-size:inherit;}& svg{font-size:inherit;}};label:emotion-cssButton;"),At=j(`@layer emotion-component{&.ant-btn-primary:not(
        [disabled],
        .ant-btn-disabled,
        .ant-btn-background-ghost
      ){background-image:linear-gradient(
        to right,
        var(`,Y,`)
          var(`,A,`),
        transparent var(`,A,`)
      );cursor:progress;}};label:emotion-cssClickCountDownProgressing;`);function jt(){try{return gt()}catch{return}}function Rt(n){try{return wt(n)}catch{return}}function Ut(){const n=h.useMemo(function(){const t=F(()=>({countDown:null}));function o(){const f=t.getState().countDown;f&&(t.setState({countDown:null}),f.abort())}function r({countDownMs:f}){return o(),new Promise(c=>{const i=setTimeout(function(){c(),o()},f);function l(){clearTimeout(i),o()}const u=new Date;t.setState({countDown:{startDate:u,endDate:kt(u,f),progress:100,abort:l}})})}const s=[];let a=bt;s.push(t.subscribe(function(c){if(!c)return;a();let i=!1;a=function(){i=!0};function l(){if(i)return;const{countDown:u}=t.getState();if(!u)return;const y=u.progress,E=100-Math.max(Math.min(100,(Date.now()-u.startDate.getTime())/(u.endDate.getTime()-u.startDate.getTime())*100),0);E!==y&&t.setState(m=>m.countDown?{countDown:{...m.countDown,progress:E}}:{}),requestAnimationFrame(l)}l()}));function d(){h.useEffect(function(){return function(){a(),o();for(const i of s)i()}},[])}function p(){return!!t(c=>c.countDown)}return{useStore:t,start:r,clear:o,useCleanup:d,useIsCounting:p}},[]);return n.useCleanup(),n}const zt=h.forwardRef(function({external:e,style:t,clickCountDownMs:o=0,imperativeHandleRef:r,to:s,...a},d){const p=jt(),f=h.useMemo(()=>e??!!a.href,[e,a.href]),c=v((...g)=>{var $;const b=($=a.onClick)==null?void 0:$.call(a,...g);return g[0].defaultPrevented||s&&mt(g[0],a.target)&&(g[0].preventDefault(),p==null||p(s)),b}),i=Ut(),l=i.useStore(g=>g.countDown),u=i.useIsCounting(),y=h.useMemo(()=>({abortClickCountDown:i.clear}),[i.clear]);h.useImperativeHandle(r,()=>y,[y]);const E=v(function(...b){if(!i.useStore.getState().countDown)return i.start({countDownMs:o}).then(()=>c(...b))}),m=h.useMemo(()=>s?{href:pt.join(rt,s)}:{href:a.href},[a.href,s]),D=h.useMemo(()=>f?{target:"target"in a?a.target:"_blank",rel:"rel"in a?a.rel:"noopener noreferrer",icon:"icon"in a?a.icon:_(ot,{"un-i-motif":"new_window"})}:{},[f,a]),P=v((...g)=>{const b=(o?E:c)(...g);w==null||w.mutate(b)}),w=Rt({mutationFn:async g=>g}),tt=h.useMemo(()=>({...t,...o?function(){if(!o)return{};const b=a.clickCountDownColor??(a.danger?k.colors.red007:k.colors.blue007);return{[Y]:b,[A]:`${(l==null?void 0:l.progress)??0}%`}}():null}),[l==null?void 0:l.progress,o,a,t]);return _(yt,{style:tt,css:j([Ot,u&&At],";label:emotion-ButtonInternal;"),ref:d,...!w||!(w.isLoading||u)?null:{loading:!0,inert:""},...D,...a,onClick:P,...m})}),he=x(zt);export{he as B,G as e};
